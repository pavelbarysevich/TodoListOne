import SwiftUI

/// –≠–∫—Ä–∞–Ω —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á:
/// - –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–¥–∞—á, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
/// - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å, –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å, —É–¥–∞–ª—è—Ç—å, –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
struct ListView: View {
    /// –ü–æ–ª—É—á–∞–µ–º –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –∏ –º–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
    @Environment(ListViewModel.self) private var listViewModel
    
    /// –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞
    var body: some View {
        // –°–ª–æ–π –Ω–∞–ª–æ–∂–µ–Ω–∏—è: –ª–∏–±–æ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á, –ª–∏–±–æ —ç–∫—Ä–∞–Ω "–ù–µ—Ç –∑–∞–¥–∞—á"
        ZStack {
            // –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            if listViewModel.items.isEmpty {
                NoItemsView() // –ö–∞—Å—Ç–æ–º–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                    .transition(AnyTransition.opacity.animation(.easeIn))
            }
            // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            else {
                // –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è—Ç—å –∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
                List {
                    // –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞
                    ForEach(listViewModel.items) { item in
                        ListRow(item: item)
                            // –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∑–∞–¥–∞—á—É ‚Äî –ø–æ–º–µ—Ç–∏—Ç—å –µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é) —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                            .onTapGesture {
                                withAnimation(.linear) {
                                    listViewModel.updateItem(item: item)
                                }
                            }
                    }
                    // –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞—á–∏ —Å–≤–∞–π–ø–æ–º –≤–ª–µ–≤–æ
                    .onDelete(perform: listViewModel.onDelete)
                    // –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º
                    .onMove(perform: listViewModel.onMove)
                }
                // –û–±—ã—á–Ω—ã–π (–ø–ª–æ—Å–∫–∏–π) —Å—Ç–∏–ª—å —Å–ø–∏—Å–∫–∞, –±–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
                .listStyle(.plain)
            }
            
        }
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —ç–∫—Ä–∞–Ω–∞
        .navigationTitle("–ó–∞–¥–∞—á–∏ üñäÔ∏è")
        // –í–µ—Ä—Ö–Ω–∏–π —Ç—É–ª–±–∞—Ä: –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        .toolbar {
            // –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)
            ToolbarItem(placement: .navigationBarLeading) {
                EditButton()
            }
            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
            ToolbarItem(placement: .navigationBarTrailing) {
                NavigationLink("–î–æ–±–∞–≤–∏—Ç—å", destination: AddListView())
                
            }
        }
    }
}

#Preview {
    NavigationStack {
        ListView()
    }
    .environment(ListViewModel())
}

